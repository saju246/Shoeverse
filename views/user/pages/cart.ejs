
<!-- Add this to include SweetAlert library -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-xw8wP5nTU3H2L5zBc2U5PXLo5bApbojJxKLyZDo7W8HSeVw25Gr1xkvLRKiPJd5BDbtVK3gabKcsMtxN6+YJ8Q==" crossorigin="anonymous" />

<div class="fix">
  <div class="side-info">
    <button class="side-info-close"><i class="fal fa-times"></i></button>
    <div class="side-info-content">
      <div class="mobile-menu"></div>
      <div class="contact-infos mb-30">
        <div class="contact-list mb-30">
          <h4>Office Address</h4>
          <p>123/A, Miranda City Likaoli
            Prikano, Dope</p>
        </div>
        <div class="contact-list mb-30">
          <h4>Phone Number</h4>
          <p>+0989 7876 9865 9</p>
          <p>+(090) 8765 86543 85</p>
        </div>
        <div class="contact-list mb-30">
          <h4>Email Address</h4>
          <p><a href="https://wphix.com/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="92fbfcf4fdd2f7eaf3ffe2fef7bcf1fdff">[email&#160;protected]</a></p>
          <p><a href="https://wphix.com/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="25405d44485549400b48444c49654d50480b464a48">[email&#160;protected]</a></p>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="offcanvas-overlay"></div>


<% if ( cartItems && cartItems.products && cartItems.products.length) { %>
<form action="/checkout" method="post" ">
    <div class=" f_cart_area pt-110 mb-100">
  <div class="container">
    <div class="row">
      <div class="col-xl-8 col-lg-8 col-md-12">
        <div class=" cart_table">

          <table>
            <tr>
              <td>Product</td>
              <td></td>
              <td>price</td>
              <td>Quantity</td>
              <td>Total</td>

            </tr>
            <% cartItems?.products?.forEach((product,index)=> { %>
            <tbody>
              <tr class="max-width-set">
                <td>
                  <a href="/viewProduct/<%=product.product?._id %>">
                    <% if (product.product && product.product.images && product.product.images[0] &&
                          product.product.images[0].thumbnailUrl) { %>
                    <img src="<%= product.product.images[0].thumbnailUrl %>" alt="Thumbnail" class="img-thumbnail" />
                    <% } else { %>
                    <!-- Handle the case where thumbnailUrl is not available -->
                    <img src="placeholder-thumbnail-url.jpg" alt="Placeholder" class="img-thumbnail" />
                    <% } %>
                  </a>
                </td>
                <td> <a href="/product/<%= product.product._id %>">
                    <%= product.product.title %>
                  </a>
                  <% if (product.product.isDeleted) { %>
                  <p class="text-danger">Currently Unavailable</p>
                  <% } else if (product.product.quantity < product.quantity) { %>
                  <p class="text-danger">Out of Stock</p>
                  <% } %>
                </td>
                <td><span>$ <span class="amount">
                      <% const productPrice=parseFloat(product.product.salePrice) %>
                      <%= productPrice.toFixed(2) %>
                    </span></span> </td>
                <td>
                  <div class="viewcontent__action single_action pt-30">
                    <a href="javascript:void(0);" class="btn btn-outline-secondary h-auto minusBtn decrease-quantity" data-product-id="<%= product.product._id %>">
  <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-minus" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none" />
    <path d="M5 12l14 0" />
  </svg>
</a>
                    <span class="btn btn-dark h-auto quantity" id="quantity_<%= product.product._id %>">
                      <%= product.quantity %>
                    </span>

                    <a href="javascript:void(0);" class="btn btn-outline-secondary h-auto plusBtn" data-product-id="<%= product.product._id %>" id="plusBtn">
                      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-plus" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                        <path d="M12 5l0 14" />
                        <path d="M5 12l14 0" />
                      </svg>
                    </a>
                  </div>
                </td class="product-subtotal" id="totalProductPrice_<%= product.product._id %>">

                <td class="product-subtotal" id="totalProductPrice_<%= product.product._id %>">
                  <% if (product.product) { %>
                  <% const productTotal=parseFloat(product.product.salePrice); %>
                  <% const productQuantity=parseInt(product.quantity, 10); %>
                  <% const totalProductPrice=productTotal * productQuantity; %>
                  <%= totalProductPrice.toFixed(2) %>
                  <% } else { %>
                  <!-- Handle the case where product information is not available -->
                  â‚¹0.00 <% } %>

                </td>
                </td>
                <td class="width-set">
  <!-- Modify the link to trigger SweetAlert confirmation -->
  <a href="#" class="remove-from-cart" data-product-id="<%= product.product._id %>"><i class="fas fa-trash"></i></a>
</td>

              </tr>

            </tbody>
            <% }) %>

            <!-- <tfoot>
                                        <tr class="design-footer">
                                            <td>
                                                <input type="text" placeholder="Coupon Code">
                                            </td>
                                            <td><button type="submit">Apply Coupon</button></td>
                                            <td colspan="3"><a href="#">update cart</a></td>
                                        </tr>
                                    </tfoot> --!>
                        </table>
                       
                        </div>
                        </div>
        <div class="col-xl-4 col-lg-4 col-md-12">
            <div class="cart__acount">
                <h5>Cart totals</h5>
                
                <table>

                    
                    <tr class="first-child">
                        <td>sub total</td>
                        <td id="subtotal">
                            <%= subtotal.toFixed(2) %>
                        </td>
                    </tr>
                    <tr>
                        <td>total</td>
                        <td id="cart-total">
                            <%= total.toFixed(2) %>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <% if (cartItems.products.some(product=>
                product.product.quantity < product.quantity ) ||
                cartItems.products.some(product=> product.product.isDeleted)) {
                %>
                <button
                  class="btn btn-secondary cursor-na btn-dark"
                  type="submit"
                  disabled
                >
                  Proceed to checkout
                </button>
                <% } else { %>
                <button id="checkoutBtn" class="btn btn-dark" >
                  Proceed to checkout
                </button>
                <% } %>
                
                </td>
        </tr>
        
                  
                </table>
                </div>
                </div>
                </div>
                </div>
                </form>
                <% }else{ %>
                    <<div class="f_cart_area pt-110 mb-100">
    <div class="container">
        <div class="row">
            <div class="col-12 text-center">
                <h1>No items in the Cart</h1>
                <br>
                <a href="/shop">
                    <button class="btn btn-primary mx-auto">Shop Now</button>
                </a>
            </div>
        </div>
    </div>
</div>

        <%}%>
        
        

                                    <script src="./user/assets/js/shop/cart.js"></script>
                                    
                                    <script>
  // Add this script to handle SweetAlert confirmation
  document.addEventListener("DOMContentLoaded", function () {
    // Select all elements with the class 'remove-from-cart'
    var removeLinks = document.querySelectorAll('.remove-from-cart');

    // Loop through each link and attach a click event listener
    removeLinks.forEach(function (link) {
      link.addEventListener('click', function (event) {
        event.preventDefault();

        // Get the product ID from the data-product-id attribute
        var productId = link.getAttribute('data-product-id');

        // Show SweetAlert confirmation
        Swal.fire({
          title: 'Are you sure?',
          text: 'Do you want to remove this item from the cart?',
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#3085d6',
          cancelButtonColor: '#d33',
          confirmButtonText: 'Yes, remove it!'
        }).then((result) => {
          if (result.isConfirmed) {
            // If the user confirms, proceed with the removal
            window.location.href = '/cart/remove/' + productId;
          }
        });
      });
    });
  });
</script>


